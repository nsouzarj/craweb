<div class="user-form-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>
        {{ isEditMode ? 'Editar Usuário' : 'Novo Usuário' }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ isEditMode ? 'Altere os dados do usuário' : 'Preencha os dados do novo usuário' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <!-- Basic Information -->
        <div class="form-section">
          <h3>Informações Básicas</h3>
          
          <div class="form-row">
            <mat-form-field class="form-field" appearance="outline">
              <mat-label>Login *</mat-label>
              <input matInput formControlName="login" [readonly]="isEditMode">
              <mat-error *ngIf="userForm.get('login')?.hasError('required')">
                Login é obrigatório
              </mat-error>
              <mat-error *ngIf="userForm.get('login')?.hasError('minlength')">
                Login deve ter pelo menos 3 caracteres
              </mat-error>
              <mat-error *ngIf="userForm.get('login')?.hasError('maxlength')">
                Login deve ter no máximo 50 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field class="form-field" appearance="outline">
              <mat-label>Nome Completo *</mat-label>
              <input matInput formControlName="nomecompleto">
              <mat-error *ngIf="userForm.get('nomecompleto')?.hasError('required')">
                Nome completo é obrigatório
              </mat-error>
              <mat-error *ngIf="userForm.get('nomeCompleto')?.hasError('maxlength')">
                Nome deve ter no máximo 255 caracteres
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field class="form-field" appearance="outline" *ngIf="!isEditMode">
              <mat-label>Senha *</mat-label>
              <input matInput type="password" formControlName="senha">
              <mat-error *ngIf="userForm.get('senha')?.hasError('required')">
                Senha é obrigatória
              </mat-error>
              <mat-error *ngIf="userForm.get('senha')?.hasError('minlength')">
                Senha deve ter pelo menos 6 caracteres
              </mat-error>
              <mat-error *ngIf="userForm.get('senha')?.hasError('maxlength')">
                Senha deve ter no máximo 100 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field class="form-field" appearance="outline" *ngIf="isEditMode">
              <mat-label>Senha</mat-label>
              <input matInput type="password" formControlName="senha" placeholder="Deixe em branco para manter a senha atual">
              <mat-hint>Deixe em branco para manter a senha atual</mat-hint>
              <mat-error *ngIf="userForm.get('senha')?.hasError('minlength')">
                Senha deve ter pelo menos 6 caracteres
              </mat-error>
              <mat-error *ngIf="userForm.get('senha')?.hasError('maxlength')">
                Senha deve ter no máximo 100 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field class="form-field" appearance="outline">
              <mat-label>Tipo de Usuário *</mat-label>
              <mat-select formControlName="tipo">
                <mat-option [value]="UserType.ADMIN">Administrador</mat-option>
                <mat-option [value]="UserType.ADVOGADO">Advogado</mat-option>
                <mat-option [value]="UserType.CORRESPONDENTE">Correspondente</mat-option>
              </mat-select>
              <mat-error *ngIf="userForm.get('tipo')?.hasError('required')">
                Tipo de usuário é obrigatório
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="form-section">
          <h3>Informações de Contato</h3>
          
          <mat-form-field class="form-field full-width" appearance="outline">
            <mat-label>Email Principal</mat-label>
            <input matInput type="email" formControlName="emailprincipal">
            <mat-error *ngIf="userForm.get('emailPrincipal')?.hasError('email')">
              Email inválido
            </mat-error>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field class="form-field" appearance="outline">
              <mat-label>Email Secundário</mat-label>
              <input matInput type="email" formControlName="emailsecundario">
              <mat-error *ngIf="userForm.get('emailSecundario')?.hasError('email')">
                Email inválido
              </mat-error>
            </mat-form-field>

            <mat-form-field class="form-field" appearance="outline">
              <mat-label>Email Responsável</mat-label>
              <input matInput type="email" formControlName="emailresponsavel">
              <mat-error *ngIf="userForm.get('emailResponsavel')?.hasError('email')">
                Email inválido
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Status (Edit Mode Only) -->
        <div class="form-section" *ngIf="isEditMode">
          <h3>Status</h3>
          
          <mat-slide-toggle formControlName="ativo" color="primary">
            {{ userForm.get('ativo')?.value ? 'Usuário Ativo' : 'Usuário Inativo' }}
          </mat-slide-toggle>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button mat-button type="button" (click)="onCancel()">
            Cancelar
          </button>
          <button mat-raised-button color="primary" type="submit" 
                  [disabled]="userForm.invalid || loading">
            <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
            <span *ngIf="!loading">{{ isEditMode ? 'Atualizar' : 'Criar' }}</span>
            <span *ngIf="loading">{{ isEditMode ? 'Atualizando...' : 'Criando...' }}</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Password Change Section (Edit Mode Only) -->
  <mat-card class="form-card" *ngIf="isEditMode">
    <mat-card-header>
      <mat-card-title>Alterar Senha</mat-card-title>
      <mat-card-subtitle>Deixe em branco para manter a senha atual</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
        <div class="form-row">
          <mat-form-field class="form-field" appearance="outline">
            <mat-label>Nova Senha</mat-label>
            <input matInput type="password" formControlName="novaSenha">
            <mat-error *ngIf="passwordForm.get('novaSenha')?.hasError('minlength')">
              Senha deve ter pelo menos 6 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field class="form-field" appearance="outline">
            <mat-label>Confirmar Nova Senha</mat-label>
            <input matInput type="password" formControlName="confirmarSenha">
            <mat-error *ngIf="passwordForm.get('confirmarSenha')?.hasError('passwordMismatch')">
              Senhas não coincidem
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="accent" type="submit" 
                  [disabled]="passwordForm.invalid || changingPassword">
            <mat-spinner diameter="20" *ngIf="changingPassword"></mat-spinner>
            <span *ngIf="!changingPassword">Alterar Senha</span>
            <span *ngIf="changingPassword">Alterando...</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>